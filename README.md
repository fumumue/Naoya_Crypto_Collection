# USAGE
ulimit -s unlimited

gcc -O3 naoya.c

./a.out


# 2. 暗号化手順（1変数版）
以下、qを256ビット素数とし$Z_q$上の多項式を考える。$a_i \in Z_q$とする。
1. 秘密多項式:　$l=(x-a_0)(x-a_1)...(x-a_{d+s}),n=d+s+1$とする。

  ここで$a_i$は、重複なくランダムに選んだ値$a \in F_q$とし、これが秘密鍵である。

2. ランダム多項式 $R,deg(R)=d$ を生成する。

3. 公開鍵生成:$C_a$を秘密多項式$l$にかける秘密の値とする。公開鍵は、
   $$
   \text{pub}(x) = R(x) + l'(x), \quad l'=C_al
   $$
  であるとする。（これによって秘密多項式ｌがスケーリングされる）
  
4. 暗号化:
   平文多項式 $m$ とランダム多項式 $r,R'$ を用いて
   $$
   c = pub(m)+R' = (R + l')(m+r) + R'
   $$
   とし、$c_0=(c,r)$を暗号文として送信する。
  ここで、$deg(R')=d+s,deg(r)=s+1,deg(m)=s$であるとする。

---

# 3. 復号手順

### 1. 秘密点 $(a_i \in F_q)$ を用いて、暗号文から平文成分を消去。
  $$c=(R+l')(m+r)+R'=Rm+Rr+l'm+l'r+R'$$

  より、$deg(l')=d+s+1$であり、$d+s+1$個の点で消える。
  つまり$l'(a)=0$から$(l'm+l'r)(a)=0$であり、$c_s=Rm+Rr+R'$とすると、 
  $deg(c_s)=d+s$なので、$a$の$c_s$への代入値よりラグランジュ補間法によって$c_s$が計算で求まる。
  $$c(a)=(Rm+Rr+R')(a)$$
  ここで、復号は秘密点、$$a_i \in F_q,(0 \leq i \leq d+s)$$を知っている受信者にしかできない。

 
### 2. 消去後、残りの多項式を l'(x) で割ることでmを再構成。
$$c-c'=l'm+l'r$$
さらに、受信者は$l',r$を知っていることから、$$m'=(c-c')/l'=m+r$$

最後に$m'-r=m$として平文が復号できた。

